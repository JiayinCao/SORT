<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SORT (Simple Open-source Ray Tracing) [Building]</title>

    <!-- Load jQuery -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Bootstrap 4.0 core CSS -->
    <link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="./bootstrap/js/bootstrap.min.js"></script>

    <!-- Custom styles for this template -->
    <link href="custom.css" rel="stylesheet">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T7WCLX283S"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-T7WCLX283S');
    </script>
  </head>

  <body class="text-center">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand">SORT</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="./index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./gallery.html">Gallery</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="./building.html">Building SORT</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./references.html">References</a>
            </li>
          </ul>
          <ul class="navbar-nav navbar-right">
            <li class="nav-item">
              <a class="nav-link" href="./aboutme.html">About Me</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="content-container">
        <h2>Building SORT with source code</h2>
        <p>SORT is a cross-platform project that runs on multiple platforms, including Windows, Mac OS(Both Intel and Apple Silicon), and Ubuntu.</p>
        <p>It is fully open-source and built on C++ 17. Following are the mandatory software to compile SORT:</p>
        <ul>
          <li><a href="https://cmake.org/">CMake</a> (3.1 or higher version, please also put cmake in executable directory so that the script can call it.).</li>
          <li>C++ compiler that compiles C++17. ( MSVC 2015, GCC 5 ).</li>
          <li><a href="https://www.python.org/">Python 3.x</a>.</li>
          <li><a href="https://www.blender.org/">Blender 2.8/2.9</a>. It is not a mandatory software to run SORT if there is already a resource file. However, since the input scene file is generated by Blender through SORT Blender Plugin, it is necessary to install Blender to generate input scene files.</li>
        </ul>
        <h3>Setup Compiling Environment</h3>
        <h5>Platform Independent Compiling Options</h5>
        <p>There are only a few compiling options for us to pay attention in SORT CMake generation.</p>
        <ul>
          <li><b>CMAKE_BUILD_TYPE</b><br> This is set ‘Release’ by default. Choose ‘Debug’ if you want to generate a debug build. If you only want to build SORT for running it, there is no need to touch this option.</li>
          <li><b>SORT_ENABLE_PROFILER</b><br> SORT's profiling system uses the open source project <a href="https://github.com/yse/easy_profiler">Easy Profiler</a>. Since this is a very performance sensitive option, it is turned off by default. By default, SORT won't even download and compile the library. In order to compile SORT with it, it is necessary to compile the project it first. </li>
          <li><b>SORT_ENABLE_STATS</b><br> This will enable SORT to output some statistics information after running SORT. It is also turned on by default. This feature has very limited impact on rendering performance. Leaving it on should be generally fine. However, it is also fine to turn it off if there is no need to check the statistics data after rendering.</li>
          <li><b>ENABLE_SIMD_4WAY_OPTIMIZATION</b><br> 4-way SIMD optimization. This is enabled by default since almost all modern PC and Mac have SSE. On Apple Silicon Mac, this will be implemented through Neon under the hood.</li>
          <li><b>ENABLE_SIMD_8WAY_OPTIMIZATION</b><br> 8-way optimization with AVX. This is still a largely available feature that could be used on a wide variety machines. However, since the performance improvement is very limited, this is disabled by default. This won't have any effect on Apple Silicon since Neon is not 8-way SIMD by the time this was written.</li>
          <li><b>ENABLE_FASTMATH</b><br>Some compilers support fast math optimization. This is just another option for faster ray tracing if precision is not a priority. However, since this is disabled by default, this is not properly maintained. Unknown bugs could happen with this.</li>
          <li><b>ENABLE_LINKTIME_OPTIMIZATION</b><br>Link time optimization. Enabled by default. Unless linking time is important for iteration, this should be kepted on for better performance. </li>
        </ul>
        <h5>Windows</h5>
        <p>It is necessary to install Visual Studio 2015 or above to compile SORT on Windows. And please also make sure that ‘msbuild.exe’ is in the system ‘Path’ folder so that the script can run it directly.</p>
        <h5>Mac OS</h5>
        <p>Xcode is needed to comiple SORT on MacOS.</p>
        <h5>Ubuntu</h5>
        <p>Unlike the other two platforms, for which SORT has packed all necessary libararies in the dependency, some of the depedent libraries is OS dependent. SORT doesn’t pack those OS dependent libraries with it, it is programmer’s responsibility to setup the correct environment before building it, meaning compiling SORT on Ubuntu requires some basic setup first.</p>
        <p>Following is the tools and library needed by SORT and the correct way to install them on Ubuntu (Xenial)</p>
        <ul>
          <li><b>Clang 6</b><br>wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -<br>sudo apt-add-repository "deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-6.0 main"<br>sudo apt-get update<br>sudo apt-get install -y clang-6.0</li>
          <li><b>G++ 7</b>, the default version GCC on Ubuntu Xenial won’t compile SORT successfully.<br>sudo apt-get install -y software-properties-common<br>sudo add-apt-repository ppa:ubuntu-toolchain-r/test<br>sudo apt update<br>sudo apt install g++-7 -y<br>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 60 --slave /usr/bin/g++ g++ /usr/bin/g++-7<br>sudo update-alternatives --config gcc</li>
          <li>Make sure to download the dependency through ‘getdep_ubuntu_xenial.sh’</li>
        </ul>
        <p>There is no need to setup G++ on Ubuntu Bionic and Focal since the default version comes with the system is already G++7, which is sufficient for compiling SORT.</p>
        <p>Unfortunately, due to limited resources, I don’t have time trying and maintaining SORT on every single version of Ubuntu. If you happen to build SORT on other version, you need to rebuild TSL library by yourself.</p>
        <h3>Compiling SORT</h3>
        <ul>
          <li><b>make release</b><br> Generate a release version build.</li>
          <li><b>make debug</b><br> Generate a debug version build.</li>
        </ul>
        <p>Of course, it is also possible to manually generate the project and load it by yourself in any proper way you see fit.</p>
        <h3>Other Available Commands</h3>
        <ul>
          <li><b>make update</b><br> Sync the latest code on Github.</li>
          <li><b>make update_dep</b><br> Retreive the dependencies again.</li>
          <li><b>make clean</b><br> Clean all genearated files and folders.</li>
          <li><b>make clean_dep</b><br> Clean the dependency files.</li>
          <li><b>make help</b><br> Print help message</li>
          <li><b>make dep_info</b><br> Print information about dependencies.</li>
          <li><b>make about</b><br> Print introduction about the project and myself.</li>
        </ul>
        <h3>Generated Binary</h3>
        <p>Only one executable file will be generated. It will be generated in a newly created folder ‘bin’ in the SORT root folder. For release version build, an executable named ‘sort_r’ will be generated. For debug version build, it is named ‘sort_d’.</p>

        <hr width="50%" size="8" align="center">
        <hr noshade>

        <h2>Deploying SORT</h2>
        <p>
        <h5>Active SORT in Blender</h5>
        There are two ways to activate it in Blender.
        <ul>
            <li><b>Copying the plugin to Blender</b><br>
              <p>There is a folder with the name ‘sortblend’ in SORT root folder, which has all blender plugin python source code in it. In order to add SORT in Blender as a new renderer, it is mandatory to copy the source code folder to the following folder,</p>
            <ul>
              <li><b>Windows</b><br>C:\Program Files\Blender\2.79\scripts\addons</li>
              <li><b>Mac OS</b><br>~/Library/Application Support/Blender/2.79/script/addons/</li>
              <li><b>Ubuntu</b><br>/home/$user/blender/2.79/scripts/addons/</li>
            </ul>
            <p>Depending the exact version of Blender, the above paths could be slightly different. However, the paths should be very similar with them.</p>
          </li>
          <li><b>Indirecting the path in Blender</b><br>
            It is also possible to set the script path of Blender with "[SORT_ROOT_DIR]/blender-plugin/addons". For example, it is set as "C:\Github\SORT\blender-plugin\" on my own Windows machine.
            This is a better way to sync changes between files if you are working on iteration of SORT Blender plugin since there is only one copy of the plugin source code, which is already tracked by git.
          </li>
        </ul>

        <h5>Activate SORT in Blender</h5>
        <p>After compiling SORT with source code, there should be a binary folder with the name ‘bin’ in SORT root folder. Usually, the binary is named ‘sort_r’ for release version build and ‘sort_d’ for debugging version build. It is also fine to generate or copy the binary to any other desired folder with other binary file names.</p>
        <p>Open the ‘Blender User Preferences’ in Blender by choosing ‘User Preferences’ in ‘File’ menu.</p>
        <img src="./assets/building/active.png">
        <p>
        <p>Tick the checkbox before SORT and the path of SORT binary will be automatically set if the environment variable is setup correctly.</p>

        <h5>Picking SORT as the Renderer</h5>
        <p>After SORT is activated in Blender, the next step is to pick SORT as the renderer in Blender so that Blender will send jobs to SORT for rendering. </p>
        <img src="./assets/building/pick_renderer.png">
        <p>
        <p>Simply by choosing SORT in engine will pick it as the main renderer. The rendering process is no difference from other engines.</p>

        <hr width="50%" size="8" align="center">
        <hr noshade>

        <p align="center">Copyright© 2011-2023 Jiayin Cao. All rights reserved.</p>
        <br /> 
    </div>
  </body>
</html>
